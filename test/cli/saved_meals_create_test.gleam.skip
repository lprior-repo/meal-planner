//// TDD Tests for CLI saved-meals create command
////
//// RED PHASE: This test validates:
//// 1. Creating a saved meal with valid data
//// 2. Validation of meal name (not empty)
//// 3. Validation of food items (not empty)
//// 4. Validation of quantities (positive numbers)

import gleam/list
import gleeunit
import gleeunit/should
import meal_planner/cli/domains/saved_meals

pub fn main() {
  gleeunit.main()
}

// ============================================================================
// Test Fixtures
// ============================================================================

/// Sample food item for testing
pub type FoodItem {
  FoodItem(food_id: String, quantity: Float)
}

// ============================================================================
// Validation Tests
// ============================================================================

/// Test: Creating a saved meal with valid data succeeds
pub fn create_saved_meal_with_valid_data_test() {
  let name = "Chicken & Rice"
  let items = [FoodItem(food_id: "123", quantity: 200.0)]

  let result = saved_meals.validate_meal_data(name, items)

  result |> should.be_ok()
}

/// Test: Creating a saved meal with empty name fails
pub fn create_saved_meal_with_empty_name_fails_test() {
  let name = ""
  let items = [FoodItem(food_id: "123", quantity: 200.0)]

  let result = saved_meals.validate_meal_data(name, items)

  result |> should.be_error()
}

/// Test: Creating a saved meal with no items fails
pub fn create_saved_meal_with_no_items_fails_test() {
  let name = "Empty Meal"
  let items: List(FoodItem) = []

  let result = saved_meals.validate_meal_data(name, items)

  result |> should.be_error()
}

/// Test: Creating a saved meal with zero quantity fails
pub fn create_saved_meal_with_zero_quantity_fails_test() {
  let name = "Invalid Meal"
  let items = [FoodItem(food_id: "123", quantity: 0.0)]

  let result = saved_meals.validate_meal_data(name, items)

  result |> should.be_error()
}

/// Test: Creating a saved meal with negative quantity fails
pub fn create_saved_meal_with_negative_quantity_fails_test() {
  let name = "Invalid Meal"
  let items = [FoodItem(food_id: "123", quantity: -100.0)]

  let result = saved_meals.validate_meal_data(name, items)

  result |> should.be_error()
}

/// Test: Creating a saved meal with multiple items succeeds
pub fn create_saved_meal_with_multiple_items_test() {
  let name = "Complete Meal"
  let items = [
    FoodItem(food_id: "123", quantity: 200.0),
    FoodItem(food_id: "456", quantity: 150.0),
    FoodItem(food_id: "789", quantity: 100.0),
  ]

  let result = saved_meals.validate_meal_data(name, items)

  result |> should.be_ok()
}

/// Test: Meal name with whitespace only fails
pub fn create_saved_meal_with_whitespace_only_name_fails_test() {
  let name = "   "
  let items = [FoodItem(food_id: "123", quantity: 200.0)]

  let result = saved_meals.validate_meal_data(name, items)

  result |> should.be_error()
}
