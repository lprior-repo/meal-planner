openapi: 3.0.0
info:
  title: Meal Planner Recipe API
  version: 1.0.0
  description: |
    Recipe creation and management API for the Meal Planner application.
    Supports creating, viewing, and managing recipes with nutritional information.
  contact:
    name: Meal Planner API Support

servers:
  - url: http://localhost:8080
    description: Development server

tags:
  - name: Recipes
    description: Recipe creation and management endpoints

paths:
  /recipes/new:
    get:
      summary: Get recipe creation form
      description: |
        Returns an HTML form for creating a new recipe. This is a server-side rendered
        page with all necessary input fields for recipe information including:
        - Basic details (name, category, servings)
        - Nutritional information (protein, fat, carbs)
        - Dietary attributes (FODMAP level, Vertical Diet compliance)
        - Dynamic ingredient list
        - Dynamic instruction steps
      operationId: getNewRecipeForm
      tags:
        - Recipes
      responses:
        '200':
          description: HTML form page rendered successfully
          content:
            text/html:
              schema:
                type: string
                example: |
                  <!DOCTYPE html>
                  <html>
                    <head><title>New Recipe - Meal Planner</title></head>
                    <body>
                      <form method="POST" action="/api/recipes">
                        <!-- Recipe form fields -->
                      </form>
                    </body>
                  </html>
              examples:
                recipeForm:
                  summary: Recipe creation form
                  value: |
                    Contains form fields for:
                    - name (text, required)
                    - category (select, required)
                    - servings (number, required, min: 1)
                    - protein (number, required, step: 0.1)
                    - fat (number, required, step: 0.1)
                    - carbs (number, required, step: 0.1)
                    - fodmap_level (select: low/medium/high)
                    - vertical_compliant (checkbox)
                    - ingredients (dynamic list)
                    - instructions (dynamic list)

  /api/recipes:
    post:
      summary: Create a new recipe
      description: |
        Creates a new recipe with complete nutritional and dietary information.
        Accepts form data with recipe details, ingredients, and cooking instructions.

        **Validation Rules:**
        - Name: Required, non-empty string
        - Category: Must be one of: chicken, beef, pork, seafood, vegetarian, other
        - Servings: Required integer >= 1
        - Protein/Fat/Carbs: Required floats >= 0.0
        - FODMAP Level: Must be low, medium, or high
        - Ingredients: At least one ingredient required
        - Instructions: At least one instruction required
      operationId: createRecipe
      tags:
        - Recipes
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/RecipeFormData'
            examples:
              chickenRice:
                summary: Chicken and Rice recipe
                value:
                  name: Chicken and Rice
                  category: chicken
                  servings: 1
                  protein: 45.0
                  fat: 8.0
                  carbs: 45.0
                  fodmap_level: low
                  vertical_compliant: true
                  ingredient_name_0: Chicken breast
                  ingredient_quantity_0: 8 oz
                  ingredient_name_1: White rice
                  ingredient_quantity_1: 1 cup
                  ingredient_name_2: Olive oil
                  ingredient_quantity_2: 1 tbsp
                  instruction_0: Cook rice according to package directions
                  instruction_1: Grill chicken breast until internal temperature reaches 165°F
                  instruction_2: Serve chicken over rice
              vegetarianBowl:
                summary: Vegetarian Buddha Bowl
                value:
                  name: Quinoa Buddha Bowl
                  category: vegetarian
                  servings: 2
                  protein: 15.0
                  fat: 12.0
                  carbs: 55.0
                  fodmap_level: medium
                  vertical_compliant: false
                  ingredient_name_0: Quinoa
                  ingredient_quantity_0: 1 cup
                  ingredient_name_1: Chickpeas
                  ingredient_quantity_1: 1 can (15 oz)
                  ingredient_name_2: Mixed vegetables
                  ingredient_quantity_2: 2 cups
                  instruction_0: Cook quinoa according to package directions
                  instruction_1: Roast chickpeas and vegetables at 425°F for 20 minutes
                  instruction_2: Assemble bowl with quinoa base and top with roasted items
      responses:
        '201':
          description: Recipe created successfully
          headers:
            Location:
              description: URL of the newly created recipe
              schema:
                type: string
                example: /recipes/abc123-def456
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Recipe'
              examples:
                chickenRice:
                  summary: Created chicken recipe
                  value:
                    id: abc123-def456
                    name: Chicken and Rice
                    category: chicken
                    servings: 1
                    macros:
                      protein: 45.0
                      fat: 8.0
                      carbs: 45.0
                      calories: 472.0
                    fodmap_level: low
                    vertical_compliant: true
                    ingredients:
                      - name: Chicken breast
                        quantity: 8 oz
                      - name: White rice
                        quantity: 1 cup
                      - name: Olive oil
                        quantity: 1 tbsp
                    instructions:
                      - Cook rice according to package directions
                      - Grill chicken breast until internal temperature reaches 165°F
                      - Serve chicken over rice
        '400':
          description: Invalid request - validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                missingName:
                  summary: Missing required field
                  value:
                    error: Validation failed
                    details:
                      - field: name
                        message: Recipe name is required
                invalidCategory:
                  summary: Invalid category value
                  value:
                    error: Validation failed
                    details:
                      - field: category
                        message: Category must be one of chicken, beef, pork, seafood, vegetarian, other
                invalidServings:
                  summary: Invalid servings value
                  value:
                    error: Validation failed
                    details:
                      - field: servings
                        message: Servings must be at least 1
                negativeMacros:
                  summary: Negative macro values
                  value:
                    error: Validation failed
                    details:
                      - field: protein
                        message: Protein value cannot be negative
                noIngredients:
                  summary: Missing ingredients
                  value:
                    error: Validation failed
                    details:
                      - field: ingredients
                        message: At least one ingredient is required
                noInstructions:
                  summary: Missing instructions
                  value:
                    error: Validation failed
                    details:
                      - field: instructions
                        message: At least one instruction is required
        '500':
          description: Internal server error - database or system failure
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                databaseError:
                  summary: Database connection failure
                  value:
                    error: Internal server error
                    message: Failed to save recipe to database
                systemError:
                  summary: Unexpected system error
                  value:
                    error: Internal server error
                    message: An unexpected error occurred

components:
  schemas:
    RecipeFormData:
      type: object
      required:
        - name
        - category
        - servings
        - protein
        - fat
        - carbs
        - fodmap_level
      properties:
        name:
          type: string
          description: Recipe name
          minLength: 1
          maxLength: 255
          example: Chicken and Rice
        category:
          type: string
          description: Recipe category
          enum:
            - chicken
            - beef
            - pork
            - seafood
            - vegetarian
            - other
          example: chicken
        servings:
          type: integer
          description: Number of servings the recipe yields
          minimum: 1
          maximum: 100
          example: 1
        protein:
          type: number
          format: float
          description: Protein in grams per serving
          minimum: 0
          example: 45.0
        fat:
          type: number
          format: float
          description: Fat in grams per serving
          minimum: 0
          example: 8.0
        carbs:
          type: number
          format: float
          description: Carbohydrates in grams per serving
          minimum: 0
          example: 45.0
        fodmap_level:
          type: string
          description: FODMAP level for digestive health tracking
          enum:
            - low
            - medium
            - high
          example: low
        vertical_compliant:
          type: boolean
          description: Whether recipe is compliant with Vertical Diet principles
          default: false
          example: true
        ingredient_name_0:
          type: string
          description: First ingredient name (additional numbered fields for more ingredients)
          example: Chicken breast
        ingredient_quantity_0:
          type: string
          description: First ingredient quantity (additional numbered fields for more ingredients)
          example: 8 oz
        instruction_0:
          type: string
          description: First instruction step (additional numbered fields for more steps)
          example: Cook rice according to package directions

    Recipe:
      type: object
      required:
        - id
        - name
        - ingredients
        - instructions
        - macros
        - servings
        - category
        - fodmap_level
        - vertical_compliant
      properties:
        id:
          type: string
          description: Unique recipe identifier (UUID)
          example: abc123-def456
        name:
          type: string
          description: Recipe name
          example: Chicken and Rice
        ingredients:
          type: array
          description: List of ingredients with quantities
          minItems: 1
          items:
            $ref: '#/components/schemas/Ingredient'
        instructions:
          type: array
          description: Step-by-step cooking instructions
          minItems: 1
          items:
            type: string
            example: Cook rice according to package directions
        macros:
          $ref: '#/components/schemas/Macros'
        servings:
          type: integer
          description: Number of servings
          minimum: 1
          example: 1
        category:
          type: string
          description: Recipe category
          enum:
            - chicken
            - beef
            - pork
            - seafood
            - vegetarian
            - other
          example: chicken
        fodmap_level:
          type: string
          description: FODMAP level
          enum:
            - low
            - medium
            - high
          example: low
        vertical_compliant:
          type: boolean
          description: Vertical Diet compliance
          example: true

    Ingredient:
      type: object
      required:
        - name
        - quantity
      properties:
        name:
          type: string
          description: Ingredient name
          example: Chicken breast
        quantity:
          type: string
          description: Amount or quantity (free-form text)
          example: 8 oz

    Macros:
      type: object
      required:
        - protein
        - fat
        - carbs
        - calories
      properties:
        protein:
          type: number
          format: float
          description: Protein in grams
          minimum: 0
          example: 45.0
        fat:
          type: number
          format: float
          description: Fat in grams
          minimum: 0
          example: 8.0
        carbs:
          type: number
          format: float
          description: Carbohydrates in grams
          minimum: 0
          example: 45.0
        calories:
          type: number
          format: float
          description: Total calories (calculated as protein*4 + fat*9 + carbs*4)
          minimum: 0
          example: 472.0

    Error:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Error category or title
          example: Validation failed
        message:
          type: string
          description: Detailed error message
          example: Recipe name is required
        details:
          type: array
          description: List of validation errors (for 400 responses)
          items:
            type: object
            properties:
              field:
                type: string
                description: Field that failed validation
                example: name
              message:
                type: string
                description: Validation error message
                example: Recipe name is required
