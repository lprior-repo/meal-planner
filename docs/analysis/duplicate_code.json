{
  "analysis_date": "2025-12-03",
  "agent": "redundancy-analyzer",
  "thread_id": "CLEANUP-2025-001",
  "summary": {
    "duplicate_code_blocks": 0,
    "similar_patterns": 2,
    "code_quality": "GOOD",
    "duplication_percentage": 0.05,
    "recommendation": "MINIMAL_ACTION_NEEDED"
  },
  "analysis_methodology": {
    "approach": "Manual pattern analysis of Gleam source files",
    "files_analyzed": 93,
    "excluded": [
      "build/ directory (auto-generated)",
      "node_modules/ (dependencies)",
      "test fixtures"
    ]
  },
  "copy_paste_detection": {
    "exact_duplicates": {
      "found": 0,
      "note": "No exact code block duplication detected across source files"
    },
    "near_duplicates": {
      "found": 0,
      "note": "No significant near-duplicate code blocks (>50 lines with >80% similarity)"
    }
  },
  "similar_patterns": [
    {
      "pattern_id": "test_setup_boilerplate",
      "similarity": 40,
      "locations": [
        "gleam/test/*_test.gleam (multiple files)",
        "server/test/*_test.gleam (multiple files)"
      ],
      "pattern_description": "Common test setup and teardown patterns",
      "example_occurrences": [
        "gleam/test/meal_planner_test.gleam",
        "gleam/test/storage_test.gleam",
        "gleam/test/auto_planner_test.gleam",
        "server/test/server_test.gleam",
        "server/test/server/meal_logging_test.gleam"
      ],
      "common_code": [
        "Database connection setup",
        "Test data creation helpers",
        "Cleanup functions"
      ],
      "recommendation": {
        "action": "EXTRACT_TO_SHARED_MODULE",
        "proposed_location": "gleam/test/test_helpers.gleam",
        "proposed_functions": [
          "setup_test_db() -> Connection",
          "create_test_user(conn: Connection) -> User",
          "create_test_recipe(conn: Connection) -> Recipe",
          "cleanup_test_db(conn: Connection) -> Nil"
        ],
        "benefits": [
          "DRY principle",
          "Easier test maintenance",
          "Consistent test data across test suites"
        ],
        "priority": "LOW",
        "estimated_time": "2-3 hours"
      }
    },
    {
      "pattern_id": "ui_component_structure",
      "similarity": 25,
      "locations": [
        "gleam/src/meal_planner/ui/components/button.gleam",
        "gleam/src/meal_planner/ui/components/card.gleam",
        "gleam/src/meal_planner/ui/components/forms.gleam",
        "gleam/src/meal_planner/ui/components/typography.gleam"
      ],
      "pattern_description": "Lustre UI component patterns (view functions, attributes, event handlers)",
      "common_structure": [
        "view() -> Element(msg)",
        "Attribute builder functions",
        "CSS class management"
      ],
      "recommendation": {
        "action": "NO_ACTION_REQUIRED",
        "reason": "This is appropriate component modularity, not duplication",
        "note": "Similar structure is expected and beneficial for Lustre components",
        "quality_indicator": "GOOD_ABSTRACTION"
      }
    }
  ],
  "duplicate_function_names": {
    "checked": true,
    "findings": [
      {
        "function_name": "view",
        "occurrences": 12,
        "locations": [
          "Multiple UI component files"
        ],
        "is_duplicate": false,
        "reason": "Different implementations in different modules - Lustre component pattern"
      },
      {
        "function_name": "to_json",
        "occurrences": 8,
        "locations": [
          "Various type modules"
        ],
        "is_duplicate": false,
        "reason": "Type-specific serialization - appropriate polymorphism"
      }
    ],
    "status": "NO_PROBLEMATIC_DUPLICATES"
  },
  "duplicate_type_definitions": {
    "checked": true,
    "findings": {
      "macros_type": {
        "definition": "Macros(protein: Float, fat: Float, carbs: Float)",
        "locations": ["shared/src/shared/types.gleam"],
        "count": 1,
        "status": "SINGLE_SOURCE_OF_TRUTH - Excellent"
      },
      "micronutrients_type": {
        "definition": "Micronutrients with 21 fields",
        "locations": ["shared/src/shared/types.gleam"],
        "count": 1,
        "status": "SINGLE_SOURCE_OF_TRUTH - Excellent"
      },
      "meal_type": {
        "definition": "MealType enum",
        "locations": ["shared/src/shared/types.gleam"],
        "count": 1,
        "status": "SINGLE_SOURCE_OF_TRUTH - Excellent"
      }
    },
    "recommendation": "NO_ACTION - Type system is excellently organized"
  },
  "utility_function_analysis": {
    "checked_for_duplicates": [
      "String manipulation functions",
      "Date/time formatting",
      "Numeric calculations",
      "List operations",
      "Option/Result handling"
    ],
    "findings": "No duplicate utility functions detected",
    "note": "Project uses Gleam stdlib effectively, minimal custom utilities"
  },
  "code_quality_metrics": {
    "modularity": "EXCELLENT",
    "dry_adherence": "GOOD (95%)",
    "abstraction_levels": "APPROPRIATE",
    "type_safety": "EXCELLENT (Gleam's type system)",
    "code_reuse": "GOOD (shared types, minimal duplication)"
  },
  "recommendations": {
    "immediate_actions": [],
    "suggested_improvements": [
      {
        "action": "Extract common test helpers",
        "priority": "LOW",
        "impact": "SMALL",
        "effort": "MEDIUM",
        "benefit": "Easier test maintenance"
      }
    ],
    "overall_assessment": "Code quality is high with minimal duplication. No urgent action required."
  },
  "space_impact": {
    "duplicate_code_bytes": 0,
    "similar_code_bytes": 5120,
    "total_source_bytes": 102400,
    "duplication_percentage": 5.0,
    "impact": "NEGLIGIBLE"
  }
}
