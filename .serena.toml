# Serena Configuration for Meal Planner (Gleam Project)
# This configures Serena for optimal code intelligence with Gleam

[project]
name = "meal-planner"
# Gleam files
languages = ["gleam"]
file_encoding = "utf-8"

# Project structure
root = "."
source_dirs = ["src"]
test_dirs = ["test"]

[paths]
# Include patterns for code analysis
include = [
    "src/**/*.gleam",
    "test/**/*.gleam",
    "*.md",
    "*.toml",
    "*.yml",
    "*.yaml"
]

# Exclude patterns
exclude = [
    "build/**",
    "manifest.toml",
    "**/node_modules/**",
    "**/.git/**",
    "**/__pycache__/**",
    "**/venv/**",
    "mealie-app/**",  # Mealie submodule
    ".beads/**",
    ".claude-flow/**",
    ".agent-worktrees/**"
]

[analysis]
# Symbolic analysis settings for Gleam
max_file_size_kb = 500
max_symbol_depth = 5

# Code intelligence
enable_references = true
enable_symbols = true
enable_search = true

[tools]
# Enable all essential tools
enabled = [
    "find_symbol",
    "find_referencing_symbols",
    "get_symbols_overview",
    "replace_symbol_body",
    "insert_after_symbol",
    "insert_before_symbol",
    "replace_content",
    "rename_symbol",
    "read_file",
    "create_text_file",
    "list_dir",
    "find_file",
    "search_for_pattern",
    "execute_shell_command",
    "write_memory",
    "read_memory",
    "list_memories",
    "edit_memory",
    "delete_memory"
]

[modes]
# Default modes
default = ["interactive", "editing"]

# Available modes
interactive = true  # Engage with user, ask questions
editing = true      # Can modify files
planning = false    # Planning mode (explicit activation)
one_shot = false    # Single-pass execution

[context]
type = "desktop-app"

[memories]
# Enable memories for project knowledge
enabled = true
max_size_kb = 100

[gleam]
# Gleam-specific settings
version = "1.13.0"
target = "erlang"

# Important directories
src_dir = "src"
test_dir = "test"
build_dir = "build"
migrations_dir = "schema"

# Key modules to understand
core_modules = [
    "meal_planner.gleam",
    "meal_planner/web.gleam",
    "meal_planner/types.gleam",
    "meal_planner/storage.gleam",
    "meal_planner/postgres.gleam"
]

# Testing
test_framework = "gleeunit"
property_testing = "qcheck"

[project_knowledge]
# Important facts about the codebase
description = """
Meal Planner: Gleam-based meal planning and nutrition tracking application.

Stack:
- Language: Gleam (functional, BEAM VM)
- Database: PostgreSQL (2M+ USDA foods)
- Web: Wisp + Mist HTTP server
- Frontend: Lustre SSR + HTMX (NO custom JavaScript!)
- Integration: Mealie recipe manager

Architecture:
- Pure functional core
- Side effects in storage/web layers
- OTP supervision for fault tolerance
- Result types for error handling
"""

# Development guidelines
guidelines = """
1. NO JAVASCRIPT FILES - Use HTMX only
2. Pure functions in core logic
3. Pattern matching over if/else
4. Result types instead of exceptions
5. Keep functions small (<50 lines)
6. Use symbolic tools for code navigation
"""

# Startup command
startup = "./run.sh start"

# Test command
test_command = "gleam test"

# Build command
build_command = "gleam build"

# Format command
format_command = "gleam format"
