# Meal Planner - mise configuration
# https://mise.jdx.dev/

[tools]
rust = "nightly"
mold = "latest"
sccache = "latest"
cargo-binstall = "latest"
yamllint = "latest"

# Moon for task orchestration with caching
# Installed via cargo-binstall after mise install

[env]
# Load .env file first (for non-secret overrides)
_.file = ".env"

# Tandoor API configuration (from pass)
TANDOOR_BASE_URL = "{{exec(command='pass show meal-planner/tandoor/base_url')}}"
TANDOOR_API_TOKEN = "{{exec(command='pass show meal-planner/tandoor/api_token')}}"

# Windmill configuration (from pass)
WINDMILL_API_URL = "{{exec(command='pass show meal-planner/windmill/api_url')}}"
WINDMILL_TOKEN = "{{exec(command='pass show meal-planner/windmill/token')}}"

# FatSecret API configuration (from pass)
FATSECRET_CONSUMER_KEY = "{{exec(command='pass show meal-planner/fatsecret/consumer_key')}}"
FATSECRET_CONSUMER_SECRET = "{{exec(command='pass show meal-planner/fatsecret/consumer_secret')}}"

# OAuth token encryption key (from pass) - 64 hex chars for AES-256
OAUTH_ENCRYPTION_KEY = "{{exec(command='pass show meal-planner/fatsecret/oauth_encryption_key')}}"

# Database configuration (from pass)
DATABASE_URL = "{{exec(command='pass show meal-planner/database/url')}}"

[tasks.test]
description = "Run all tests"
run = "cargo test"

[tasks.build]
description = "Build all binaries"
run = "cargo build --release"

[tasks.tandoor-test]
description = "Test Tandoor connection"
run = '''
echo "{\"base_url\": \"$TANDOOR_BASE_URL\", \"api_token\": \"$TANDOOR_API_TOKEN\"}" | ./target/debug/tandoor_test_connection
'''

[tasks.check]
description = "Run cargo check and clippy"
run = "cargo check && cargo clippy"
