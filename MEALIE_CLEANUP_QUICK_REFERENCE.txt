===============================================================================
MEALIE CLEANUP - QUICK REFERENCE GUIDE
===============================================================================

MOST CRITICAL FILES TO UPDATE FIRST
====================================

Priority 1 - Type Definitions (BLOCKING OTHERS):
1. gleam/src/meal_planner/config.gleam - MealieConfig → TandoorConfig
2. gleam/src/meal_planner/web.gleam - Rename + remove imports
3. gleam/src/meal_planner.gleam - Update main entry point

Priority 2 - Storage/Enrichment:
4. gleam/src/meal_planner/storage/mealie_enrichment.gleam → tandoor_enrichment.gleam

Priority 3 - Core Business Logic:
5. gleam/src/meal_planner/auto_planner.gleam
6. gleam/src/meal_planner/storage/logs.gleam

Priority 4 - Tests (Update after code):
7. gleam/test/food_logs_constraint_test.gleam
8. gleam/test/audit_test.gleam

Priority 5 - Database Migration:
9. gleam/migrations_pg/025_rename_mealie_recipe_to_tandoor_recipe.sql (CREATE NEW)

Priority 6 - Configuration:
10. Taskfile.yml - Remove mealie:* tasks

Priority 7 - Documentation:
11. Delete 7 MEALIE_*.md files
12. Update 8 docs with Tandoor references

Priority 8 - Environment:
13. mealie.env.example - Delete or migrate


GLEAM SOURCE FILES - DELETION LIST
===================================
Delete entire directory:
- gleam/src/meal_planner/mealie/ (contains 7 files)

Delete individual files:
- gleam/examples/bulk_create_recipes.gleam
- gleam/src/examples/bulk_create_recipes.gleam
- gleam/examples/create_recipe_example.gleam


GLEAM SOURCE FILES - UPDATE MAPPING
====================================

File                                      Type                    Mealie Refs
─────────────────────────────────────────────────────────────────────────────
meal_planner.gleam                        MAIN ENTRY              config, env vars
config.gleam                              TYPE DEFS               MealieConfig
web.gleam                                 WEB SERVER              Types, imports, handlers
auto_planner.gleam                        BUSINESS LOGIC          Types, functions
portion.gleam                             BUSINESS LOGIC          Comments
storage/logs.gleam                        STORAGE                 Comments, source_type
storage/mealie_enrichment.gleam           STORAGE                 FILE NAME + all refs
storage/recipe_validation.gleam           VALIDATION              Type refs (inspect)
types.gleam                               TYPE DEFS               Type defs (inspect)
vertical_diet_compliance.gleam            COMPLIANCE              Type refs (inspect)
meal_selection.gleam                      SELECTION               Recipe refs (inspect)
auto_planner/storage.gleam                STORAGE                 Refs (inspect)
auto_planner/ncp_auto_planner/storage.gleam STORAGE               Refs (inspect)


TEST FILES - UPDATE MAPPING
============================

File                                    Mealie Refs (Type/Content)
─────────────────────────────────────────────────────────────────
food_logs_constraint_test.gleam         "mealie_recipe" constant
audit_test.gleam                        "Mealie API" string
food_log_api_test.gleam                 Test fixtures (inspect)
health_endpoint_test.gleam              Health checks (inspect)
recipe_fallback_endpoint_test.gleam     Fallback logic (inspect)
recipe_search_test.gleam                Recipe search (inspect)
recipe_validation_integration_test.gleam Type refs (inspect)
web_proxy_endpoints_test.gleam          Endpoint refs (inspect)
migration_019_test.gleam                Schema refs (inspect)
migration_020_test.gleam                Schema refs (inspect)
migration_023_test.gleam                Schema refs (inspect)
meal_planner/portion_test.gleam         Test fixtures (inspect)


STRING REPLACEMENTS (SEARCH/REPLACE IN CODE)
=============================================

Old Pattern                          New Pattern
─────────────────────────────────────────────
MealieConfig                         TandoorConfig
MealieRecipe                         TandoorRecipe
MealieFood                           TandoorFood
MealieIngredient                     TandoorIngredient
MealieCategory                       TandoorCategory
MealieInstruction                    TandoorInstruction
mealie_recipe                        tandoor_recipe
MEALIE_BASE_URL                      TANDOOR_BASE_URL
MEALIE_API_TOKEN                     TANDOOR_API_TOKEN
MEALIE_CONNECT_TIMEOUT_MS            TANDOOR_CONNECT_TIMEOUT_MS
MEALIE_REQUEST_TIMEOUT_MS            TANDOOR_REQUEST_TIMEOUT_MS
meal_planner/mealie/                 meal_planner/tandoor/
"Filter Mealie recipes"              "Filter Tandoor recipes"
"Mealie API"                         "Tandoor API"
enrich_entry_with_mealie_data        enrich_entry_with_tandoor_data
filter_mealie_recipes_by_diet        filter_tandoor_recipes_by_diet
has_mealie_integration               has_tandoor_integration
"from Mealie recipes"                "from Tandoor recipes"
"from Mealie API"                    "from Tandoor API"


ENVIRONMENT VARIABLES MAPPING
==============================

Old Var                             New Var
─────────────────────────────────
MEALIE_BASE_URL                    TANDOOR_BASE_URL
MEALIE_API_TOKEN                   TANDOOR_API_TOKEN
MEALIE_CONNECT_TIMEOUT_MS          TANDOOR_CONNECT_TIMEOUT_MS
MEALIE_REQUEST_TIMEOUT_MS          TANDOOR_REQUEST_TIMEOUT_MS
POSTGRES_DB=mealie                 POSTGRES_DB=tandoor


DOCUMENTATION FILES - DELETION LIST
====================================

Delete these files (7 files):
- docs/MEALIE_CREDENTIAL_VERIFICATION.md (448 lines)
- docs/MEALIE_MIGRATION_GUIDE.md (233 lines)
- docs/MEALIE_PERFORMANCE_BENCHMARKS.md (639 lines)
- docs/MEALIE_TROUBLESHOOTING.md (234 lines)
- MEALIE_DATABASE_SETUP.md
- MEALIE_INTEGRATION.md
- MEALIE_RESEARCH_FINDINGS.md


DOCUMENTATION FILES - UPDATE LIST
==================================

File                                    Change
─────────────────────────────────────────────────────
docs/MEAL_PLAN_GENERATION_TESTS.md      Replace Mealie refs
docs/PERFORMANCE_BENCHMARKS.md          "Mealie database" → "Tandoor database"
docs/ROLLBACK_PROCEDURE.md              Replace examples
gleam/docs/TEST_REQUIREMENTS.md         Update refs (inspect)
FOOD_LOG_API_UPDATE.md                  save_food_log_from_mealie_recipe → tandoor
REFACTORING_NOTES.md                    Remove Mealie context
WEEKLY_SUMMARY_TEST_RESULTS.md          Update Mealie refs
ENVIRONMENT_SETUP.md                    Remove Mealie setup (inspect)
DOCKER_SETUP.md                         Remove Mealie setup (inspect)
README.md                               Remove Mealie setup (inspect)


CONFIGURATION FILES - UPDATES
==============================

File                    Change
───────────────────────────────────────────────────────────
Taskfile.yml            Remove all mealie:* tasks
                        Remove MEALIE_DB variable
                        Update descriptions
                        Change Docker image to Tandoor
                        Update database name references

mealie.env.example      DELETE (Mealie-specific config)

docker-compose.yml      Remove Mealie service (if present)

gleam/.env              Replace MEALIE_* vars with TANDOOR_*

.serena.toml            Update service refs (if present)


DATABASE MIGRATION CHECKLIST
=============================

File: gleam/migrations_pg/025_rename_mealie_recipe_to_tandoor_recipe.sql
Status: MUST CREATE (does not exist yet)

Content should include:
- ALTER TABLE food_logs DROP CONSTRAINT IF EXISTS food_logs_source_type_check
- UPDATE food_logs SET source_type = 'tandoor_recipe' WHERE source_type = 'mealie_recipe'
- ALTER TABLE food_logs ADD CONSTRAINT food_logs_source_type_check
  CHECK (source_type = ANY (ARRAY['tandoor_recipe'::text, 'custom_food'::text, 'usda_food'::text]))

Also create rollback:
- gleam/migrations_pg/rollback/025_rename_mealie_recipe_to_tandoor_recipe.sql


VERIFICATION COMMANDS
=====================

After making changes, run:

1. Build check:
   cd gleam && gleam build

2. Test check:
   cd gleam && gleam test

3. Search for remaining Mealie refs:
   grep -ri "mealie" gleam/src gleam/test --exclude-dir=mealie-app | \
   grep -v "Migration" | grep -v "rollback" | grep -v "historical"

4. Verify imports:
   grep -r "import meal_planner/mealie" gleam/src gleam/test
   (Should return nothing)

5. Verify type defs:
   grep -r "type Mealie" gleam/src
   (Should return nothing)

6. Check constraint in tests:
   grep "mealie_recipe\|tandoor_recipe" gleam/test/food_logs_constraint_test.gleam


GIT COMMIT STRATEGY
===================

Suggested commits (in order):

1. "Remove Mealie modules and imports"
   - Delete gleam/src/meal_planner/mealie/ directory
   - Delete example files
   - Remove imports from source files

2. "Rename MealieConfig to TandoorConfig"
   - Update config.gleam, web.gleam, main entry point

3. "Update type references: Mealie → Tandoor"
   - Replace type definitions across codebase
   - Update function names

4. "Update tests for Tandoor integration"
   - food_logs_constraint_test.gleam (mealie_recipe → tandoor_recipe)
   - audit_test.gleam ("Mealie API" → "Tandoor API")
   - Other test fixtures

5. "Create migration 025: mealie_recipe → tandoor_recipe"
   - Add migration SQL file
   - Add rollback file

6. "Delete Mealie-specific documentation"
   - Remove 7 MEALIE_*.md files

7. "Update documentation for Tandoor"
   - Update remaining docs
   - Remove Mealie setup instructions

8. "Update build configuration for Tandoor"
   - Taskfile.yml changes
   - docker-compose.yml changes
   - Environment files

9. "Update environment variables to TANDOOR_*"
   - config.gleam env loading
   - .env files
   - examples

10. "Final verification and cleanup"
    - Ensure build passes
    - Ensure tests pass
    - Final grep for any remaining Mealie refs


QUICK STATS
===========

Total files with "mealie" references:     ~58 files
Files to DELETE:                          13 files
Files to UPDATE:                          45 files
Files to CREATE:                          1 file (migration)

Gleam source files affected:              20 files
Test files affected:                      12 files
Migration files affected:                 2 files (keep, don't modify)
Documentation files affected:             15 files
Configuration files affected:             6 files

Estimated total changes:                  ~200 line edits across codebase


DEPENDENCIES AND BLOCKERS
==========================

Core blocking dependency:
1. config.gleam - MealieConfig type
   ↓ MUST update BEFORE:
   - web.gleam
   - auto_planner.gleam
   - storage modules
   - All types using MealieConfig

2. web.gleam - Import statements
   ↓ MUST update BEFORE:
   - Handler functions
   - Error mapping
   - Type definitions

3. Type definitions (Recipe types)
   ↓ MUST define BEFORE:
   - Test fixtures can use them
   - Handlers can return them

4. Test updates
   ↓ MUST happen AFTER:
   - Source code types are updated
   - But BEFORE final build verification

5. Migration 025
   ↓ MUST be created BEFORE:
   - Production deployment
   - Database sync


MOST COMPLEX CHANGES
====================

1. mealie_enrichment.gleam → tandoor_enrichment.gleam
   - FILE RENAME + all function renames + import updates
   - Used by storage/logs.gleam
   - Tests must be updated
   - Complexity: HIGH

2. auto_planner.gleam
   - Multiple type references
   - Function renames
   - Imports changes
   - Complexity: MEDIUM-HIGH

3. Test fixtures
   - Must handle both MealieRecipe → TandoorRecipe
   - Constraint changes (mealie_recipe → tandoor_recipe)
   - Multiple test files affected
   - Complexity: MEDIUM

4. Configuration system
   - MealieConfig spread across multiple files
   - Environment variable loading
   - Timeout configurations
   - Complexity: MEDIUM


SIMPLEST CHANGES
================

1. String replacements in comments
2. Audit test ("Mealie API" → "Tandoor API")
3. Documentation updates (find/replace)
4. Taskfile.yml updates (straightforward removal)
5. Example file deletions


EXPECTED BUILD FAILURES (BEFORE FIX)
====================================

1. "module meal_planner/mealie/client not found"
   Fix: Remove mealie imports from source files

2. "Unknown type MealieConfig"
   Fix: Rename to TandoorConfig

3. "Unknown type MealieRecipe"
   Fix: Use TandoorRecipe or generic Recipe

4. "Unknown function filter_mealie_recipes_by_diet"
   Fix: Rename function

5. Test failures on source_type = "mealie_recipe"
   Fix: Update to "tandoor_recipe"


